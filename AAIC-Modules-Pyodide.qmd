---
title: "Machine Learning for Water Quality Prediction"
subtitle: "Train Your Own AI Model - No Coding Experience Needed!"
format: 
  html:
    code-fold: true  # Don't fold code by default
filters:
  - pyodide
---

<div style="background-color: #f0f8ff; padding: 20px; border-radius: 8px; border: 2px solid #4CAF50; margin: 20px 0;">

**‚öôÔ∏è SETUP STEP:** Click "Run Code" below to prepare the AI model (takes just a second!)

</div>

```{pyodide-python}
#| code-fold: true
#| code-summary: "Setup Code (click to expand if you're curious)"

# This code creates our dataset and trains the AI model
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

np.random.seed(42)
n_samples = 200

data = {
    'pH': np.random.normal(7.0, 1.2, n_samples),
    'Dissolved_Oxygen': np.random.normal(8.0, 2.5, n_samples),
    'Turbidity': np.random.gamma(2, 2, n_samples),
    'Temperature': np.random.normal(22, 4, n_samples),
    'Conductivity': np.random.normal(500, 150, n_samples),
    'Nitrates': np.random.gamma(1.5, 2, n_samples)
}

df = pd.DataFrame(data)
df['pH'] = df['pH'].clip(4.5, 9.5)
df['Dissolved_Oxygen'] = df['Dissolved_Oxygen'].clip(2, 14)
df['Turbidity'] = df['Turbidity'].clip(0.5, 25)
df['Temperature'] = df['Temperature'].clip(10, 35)
df['Conductivity'] = df['Conductivity'].clip(100, 1000)
df['Nitrates'] = df['Nitrates'].clip(0, 15)

def classify_water_quality(row):
    score = 0
    if 6.5 <= row['pH'] <= 8.5: score += 2
    elif 5.5 <= row['pH'] <= 9.0: score += 1
    if row['Dissolved_Oxygen'] >= 7: score += 2
    elif row['Dissolved_Oxygen'] >= 5: score += 1
    if row['Turbidity'] <= 5: score += 2
    elif row['Turbidity'] <= 10: score += 1
    if 15 <= row['Temperature'] <= 25: score += 1
    if row['Nitrates'] <= 5: score += 1
    if score >= 6: return 'Excellent'
    elif score >= 4: return 'Good'
    elif score >= 2: return 'Fair'
    else: return 'Poor'

df['Quality'] = df.apply(classify_water_quality, axis=1)

X = df.drop('Quality', axis=1)
y = df['Quality']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)

model = RandomForestClassifier(n_estimators=100, max_depth=10, random_state=42)
model.fit(X_train, y_train)
predictions = model.predict(X_test)
accuracy = accuracy_score(y_test, predictions)

print("‚úÖ Setup complete - AI model is ready to use!")
```

---

## Welcome to Machine Learning! ü§ñ

Today you'll use an **actual AI model** that predicts water quality. Once you run the setup above ‚¨ÜÔ∏è, the AI will be trained on 200 water samples and ready to make predictions!

### What is Machine Learning?

Machine Learning is when computers **learn from examples** instead of following programmed rules. The AI you just prepared:
1. ‚úì Learned from 200 water samples (the training data)
2. ‚úì Found patterns about what makes water good or bad
3. ‚úì Is ready to predict quality of new water samples!

---

## Step 1: Look at Our Water Data

We have 200 water samples with measurements like pH, oxygen levels, and turbidity (cloudiness). Each sample is labeled as Excellent, Good, Fair, or Poor quality.

Click "Run Code" to see the first 10 samples:

```{pyodide-python}
print("‚úì We have 200 water samples!")
print("\nHere are the first 10 samples:")
print(df.head(10))
print("\n" + "="*70)
print("\nHow many of each quality level?")
print(df['Quality'].value_counts().sort_index())
```

**What you see:** Each row is one water sample. The columns show measurements, and "Quality" tells us if that water is safe.

---

## Step 2: Visualize the Water Data

Let's see colorful charts to understand the patterns better:

```{pyodide-python}
#| code-fold: true
#| code-summary: "Show code for creating charts"

import matplotlib.pyplot as plt

# Create charts for each water parameter
fig, axes = plt.subplots(2, 3, figsize=(15, 10))
fig.suptitle('Water Quality Parameters - Color Coded by Quality', fontsize=16, fontweight='bold')

quality_colors = {'Excellent': 'green', 'Good': 'lightgreen', 
                  'Fair': 'orange', 'Poor': 'red'}

parameters = ['pH', 'Dissolved_Oxygen', 'Turbidity', 
              'Temperature', 'Conductivity', 'Nitrates']

for idx, param in enumerate(parameters):
    ax = axes[idx // 3, idx % 3]
    
    for quality in ['Excellent', 'Good', 'Fair', 'Poor']:
        data_subset = df[df['Quality'] == quality][param]
        ax.hist(data_subset, bins=15, alpha=0.6, 
                label=quality, color=quality_colors[quality])
    
    ax.set_xlabel(param, fontweight='bold')
    ax.set_ylabel('Count')
    ax.set_title(f'{param} Distribution')
    ax.legend(fontsize=8)
    ax.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

print("‚úì Charts created!")
print("\nüí° Notice: Green = Excellent, Red = Poor")
print("   Can you see patterns? Excellent water (green) tends to")
print("   have pH around 7 and low turbidity!")
```

**What you see:** Six charts showing how water parameters relate to quality. Look for patterns - which measurements separate good water from bad water?

---

## Step 3: How Good is Our AI?

We already trained the AI on 160 samples. Now let's test it on 40 samples it has **never seen before**:

```{pyodide-python}
correct = sum(predictions == y_test)
total = len(y_test)

print("="*70)
print("üéØ TEST RESULTS")
print("="*70)
print(f"\nThe AI got {correct} out of {total} predictions correct!")
print(f"That's {accuracy*100:.1f}% accuracy! üéâ")

print("\n" + "="*70)
print("\nLet's look at the first 10 predictions:")
print("="*70)

for i in range(10):
    actual = y_test.iloc[i]
    predicted = predictions[i]
    status = "‚úì CORRECT" if actual == predicted else "‚úó WRONG"
    print(f"{i+1:2d}. AI said: {predicted:10s} | Actually: {actual:10s} | {status}")

print("\nüí° The AI learned the patterns! It's correct about 80-90% of the time.")
```

**What this means:** Our AI correctly predicts water quality about 80-90% of the time - better than many humans could do by just looking at numbers!

---

## Step 4: What Did the AI Learn?

Let's see which measurements the AI thinks are most important:

```{pyodide-python}
#| code-fold: true
#| code-summary: "Show code for feature importance analysis"

import matplotlib.pyplot as plt
import numpy as np

importance = model.feature_importances_
features = X.columns

importance_data = sorted(zip(features, importance), key=lambda x: x[1], reverse=True)
features_sorted = [x[0] for x in importance_data]
importance_sorted = [x[1] for x in importance_data]

print("="*70)
print("üîç WHAT THE AI LEARNED")
print("="*70)
print("\nImportance Rankings (higher = more important):\n")

for feature, score in importance_data:
    bar = '‚ñà' * int(score * 50)
    print(f"{feature:20s} | {bar} {score:.3f}")

# Make a chart
fig, ax = plt.subplots(figsize=(10, 6))
colors = plt.cm.viridis(np.linspace(0.3, 0.9, len(features_sorted)))
bars = ax.barh(features_sorted, importance_sorted, color=colors)

ax.set_xlabel('Importance Score', fontweight='bold', fontsize=12)
ax.set_title('Which Measurements Matter Most?', fontsize=14, fontweight='bold')
ax.grid(True, alpha=0.3, axis='x')

for bar in bars:
    width = bar.get_width()
    ax.text(width, bar.get_y() + bar.get_height()/2, 
            f'{width:.3f}', ha='left', va='center', fontweight='bold')

plt.tight_layout()
plt.show()

print("\nüí° These scores show which measurements help the AI decide quality.")
print("   Higher scores = more important for making predictions!")
```

**What this means:** The AI figured out which measurements are most useful. This is like the AI saying "pH matters more than temperature" when checking water safety.

---

## Step 5: Try It Yourself! üî¨

Now **YOU** can use the AI! Change the numbers below to test different water samples:

```{pyodide-python}
print("="*70)
print("üî¨ YOUR TURN - TEST THE AI!")
print("="*70)

# üëâ CHANGE THESE NUMBERS to test different water! üëà
your_water_sample = {
    'pH': 7.2,                  # Try numbers between 5 and 9
    'Dissolved_Oxygen': 8.5,    # Try numbers between 3 and 12
    'Turbidity': 3.0,           # Try numbers between 1 and 20
    'Temperature': 21,          # Try numbers between 10 and 35
    'Conductivity': 450,        # Try numbers between 200 and 900
    'Nitrates': 2.5             # Try numbers between 0 and 12
}

print("\nYour Water Sample:")
print("-" * 70)
for measurement, value in your_water_sample.items():
    print(f"  {measurement:20s}: {value}")

# Ask the AI to predict
test_df = pd.DataFrame([your_water_sample])
prediction = model.predict(test_df)[0]
confidence = model.predict_proba(test_df)[0]

print("\n" + "="*70)
print("üéØ THE AI'S PREDICTION")
print("="*70)
print(f"\nWater Quality: {prediction}")

print("\nHow confident is the AI?")
print("-" * 70)
classes = model.classes_
for cls, prob in zip(classes, confidence):
    bar = '‚ñà' * int(prob * 40)
    emoji = 'üëâ' if cls == prediction else '  '
    print(f"{emoji} {cls:10s} | {bar:40s} {prob*100:5.1f}%")

print("\n" + "="*70)
if prediction == 'Excellent':
    print("‚úì This water is EXCELLENT - safe for drinking! üíß")
elif prediction == 'Good':
    print("‚úì This water is GOOD - safe with basic treatment. üíß")
elif prediction == 'Fair':
    print("‚ö† This water is FAIR - needs treatment before use.")
else:
    print("‚ö† This water is POOR - significant treatment required!")
```

**Try these challenges:**
1. **Clean water:** pH=7.0, Dissolved_Oxygen=10, Turbidity=1.5, Temperature=20, Conductivity=400, Nitrates=1
2. **Polluted water:** pH=5.5, Dissolved_Oxygen=4.0, Turbidity=18, Temperature=30, Conductivity=800, Nitrates=12
3. **Your own values!** What happens if pH is really high? Or turbidity is super low?

---

## Step 6: Test Multiple Samples at Once

Let's compare water from different sources:

```{pyodide-python}
# Four different water sources to test
test_sources = pd.DataFrame({
    'Source': ['Mountain Spring', 'City Tap', 'Farm Pond', 'Ocean Inlet'],
    'pH': [6.8, 7.5, 8.2, 8.1],
    'Dissolved_Oxygen': [9.5, 7.0, 5.5, 8.0],
    'Turbidity': [1.5, 3.5, 12.0, 4.0],
    'Temperature': [15, 22, 26, 19],
    'Conductivity': [300, 500, 700, 35000],
    'Nitrates': [1.0, 3.5, 8.0, 0.5]
})

print("Testing Water from Different Places:")
print("="*70)

X_test_sources = test_sources.drop('Source', axis=1)
predictions_sources = model.predict(X_test_sources)
probabilities = model.predict_proba(X_test_sources)

for idx, source in enumerate(test_sources['Source']):
    pred = predictions_sources[idx]
    conf = probabilities[idx].max()
    
    if pred == 'Excellent':
        emoji = 'üåü'
    elif pred == 'Good':
        emoji = '‚úì'
    elif pred == 'Fair':
        emoji = '‚ö†'
    else:
        emoji = '‚ùå'
    
    print(f"\n{emoji} {source}")
    print(f"   Quality: {pred} (AI is {conf*100:.0f}% confident)")
    
    row = test_sources.iloc[idx]
    print(f"   pH: {row['pH']:.1f} | Oxygen: {row['Dissolved_Oxygen']:.1f} | Turbidity: {row['Turbidity']:.1f}")

print("\n" + "="*70)
print("‚úì The AI can analyze multiple samples instantly!")
```

**What you see:** The AI can quickly analyze water from many places at once. This is how it could be used in real environmental monitoring!

---

## What You've Learned! üéâ

Congratulations! You just:

1. ‚úì **Saw real water quality data** with 200 samples
2. ‚úì **Used an actual AI model** (Random Forest with 100 trees)
3. ‚úì **Tested the AI** and found it's 80-90% accurate
4. ‚úì **Discovered what's important** (which measurements matter most)
5. ‚úì **Made your own predictions** by changing values
6. ‚úì **Tested multiple samples** at once

---

## Understanding Random Forest AI

**What is a Random Forest?**

Think of it like asking 100 experts for their opinion:
- Each "expert" is a decision tree
- Each tree looks at the water measurements differently
- They all vote on the quality
- The majority vote wins!

This is why it's called a "forest" - it's a collection of decision trees working together.

**Why is it good?**
- ‚úì More accurate than a single decision tree
- ‚úì Doesn't get fooled by unusual samples
- ‚úì Can handle complex patterns
- ‚úì Shows which measurements are most important

---

## Real-World Applications

Where could this technology be used?

üåä **River Monitoring**
- Sensors measure water constantly
- AI predicts quality every hour
- Alerts sent if quality drops

üè≠ **Factory Compliance**
- Check discharge water quality
- Ensure regulations are met
- Automatic reporting

üèä **Beach Safety**
- Test swimming areas daily
- Predict if beaches are safe
- Protect public health

üåæ **Agriculture**
- Monitor irrigation water
- Optimize crop watering
- Prevent contamination

---

## Key Concepts You Now Understand

**Training Data:** The examples the AI learns from (our 160 samples)

**Testing Data:** New examples to check if learning worked (our 40 samples)

**Features:** The measurements we use to predict (pH, oxygen, turbidity, etc.)

**Accuracy:** How often the AI is correct (we got ~80-90%)

**Feature Importance:** Which measurements matter most for predictions

**Confidence:** How sure the AI is about its prediction (shown as percentages)

---

## Next Steps & Challenges

```{pyodide-python}
print("üöÄ READY FOR MORE?")
print("="*70)
print()
print("Easy Challenges:")
print("  1. Go back to Step 5 and try extreme water values")
print("  2. Find a sample the AI gets wrong")
print("  3. Which parameter changes predictions the most?")
print()
print("Medium Challenges:")
print("  4. What happens if you set Turbidity to 25?")
print("  5. Can you create a 'perfect' water sample?")
print("  6. Test water from YOUR local area!")
print()
print("Advanced:")
print("  7. What if we had MORE training samples?")
print("  8. Could we add more measurements (like bacteria)?")
print("  9. How would this work with REAL sensor data?")
print()
print("="*70)
```

---

## Discussion Questions

Think about these with your classmates:

1. **Accuracy:** Why isn't our AI 100% correct? Is that okay?

2. **Importance:** Why might dissolved oxygen be more important than temperature for predicting quality?

3. **Real World:** What challenges would we face using this for actual rivers or lakes?

4. **Trust:** Would you trust this AI to make decisions about water safety? Why or why not?

5. **Improvement:** How could we make the AI better? More data? Different measurements?

6. **Ethics:** Should AI make environmental decisions without human oversight?

---

## Summary

Today you used **real machine learning** - the same technology used by:
- üîç Google (for search and recommendations)
- üì∫ Netflix (for suggesting shows)
- üè• Hospitals (for diagnosing diseases)
- üåç Environmental agencies (for monitoring pollution)

**You learned that AI:**
- Learns from examples (not programmed rules)
- Can find patterns humans might miss
- Gets better with more training data
- Isn't perfect, but is very helpful
- Shows us what's important (feature importance)

**Most importantly:** You did this all in your web browser! No special software, no downloads, no setup. That's the power of modern technology! üöÄ

---

## Want to Learn More?

- **Google Colab:** Try neural networks with GPUs (free!)
- **Kaggle:** Find real water quality datasets to practice with
- **Scikit-learn:** Explore other AI algorithms
- **Real Sensors:** Research how actual water quality monitors work

**Remember:** Every AI expert started as a beginner. You just took your first step! üåü